

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Predicting Outcomes for New Data &mdash; mlr - Machine Learning in R</title>
    <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="mlr - Machine Learning in R" href="../index.html" />
    <link rel="up" title="Tutorial" href="index.html" />
    <link rel="next" title="Resampling Learners" href="resample.html" />
    <link rel="prev" title="Training a learner" href="train.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <p class="logo"><a href="../index.html">
            <img class="logo" src="../_static/mlr_logo-120x64.png" alt="mlr logo"/>
        </a></p>
        <h1><a href="../index.html">mlr - Machine Learning in R</a></h1>
        <div class="rel">
          <a href="train.html" title="Training a learner"
             accesskey="P">previous</a> |
          <a href="resample.html" title="Resampling Learners"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="predicting-outcomes-for-new-data">
<h1>Predicting Outcomes for New Data<a class="headerlink" href="#predicting-outcomes-for-new-data" title="Permalink to this headline">¶</a></h1>
<p>This section is pretty straightforward and - as you might have guessed
- deals with predicting target values for new observations. It is
implemented the same way as most of the other predict methods in R,
but predictions are encapsulated in a special object. Read the
documentation of the <a class="reference external" href="/_static/mlr/Prediction-class.html">Prediction</a> class to see all available
accessors.</p>
<div class="section" id="classification-example">
<h2>Classification example<a class="headerlink" href="#classification-example" title="Permalink to this headline">¶</a></h2>
<p>In case of a classification task the result of <a class="reference external" href="/_static/mlr/predict.html">predict</a> depends on
the predict type which was set when generating the Learner (
&lt;a href=&#8221;learner.html&#8221;&gt;Integrated Learners&lt;/a&gt;). Per default class labels are predicted.
although the advantage is not obvious for this, this will come in handy later...</p>
<p>We start again by loading <strong>mlr</strong> and creating a classification task for the Iris dataset.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span><span class="s">&quot;mlr&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> ct <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span>data <span class="o">=</span> iris<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;Species&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we select two subsets of the data. One to train the classifier
and the second one as a test set which we want to</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> train.set <span class="o">&lt;-</span> seq<span class="p">(</span>from <span class="o">=</span> <span class="m">1</span><span class="p">,</span> to <span class="o">=</span> nrow<span class="p">(</span>iris<span class="p">),</span> by <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
<span class="o">&gt;</span> test.set <span class="o">&lt;-</span> seq<span class="p">(</span>from <span class="o">=</span> <span class="m">2</span><span class="p">,</span> to <span class="o">=</span> nrow<span class="p">(</span>iris<span class="p">),</span> by <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can train a decision tree using only the subset the
observations specified by <cite>train.set</cite>:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> wm <span class="o">&lt;-</span> train<span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span> ct<span class="p">,</span> subset <span class="o">=</span> train.set<span class="p">)</span>
</pre></div>
</div>
<p>Finally, to predict the outcome on new values, we use the <a class="reference external" href="/_static/mlr/predict.html">predict</a> method:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> p <span class="o">&lt;-</span> predict<span class="p">(</span>wm<span class="p">,</span> newdata <span class="o">=</span> iris<span class="p">[</span>train.set<span class="p">,</span> <span class="p">])</span>
<span class="o">&gt;</span> head<span class="p">(</span>p<span class="p">@</span>df<span class="p">)</span>
    truth response
<span class="m">1</span>  setosa   setosa
<span class="m">3</span>  setosa   setosa
<span class="m">5</span>  setosa   setosa
<span class="m">7</span>  setosa   setosa
<span class="m">9</span>  setosa   setosa
<span class="m">11</span> setosa   setosa
</pre></div>
</div>
<p>Alternativly we can also predict directly from a task:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> p <span class="o">&lt;-</span> predict<span class="p">(</span>wm<span class="p">,</span> task <span class="o">=</span> ct<span class="p">,</span> subset <span class="o">=</span> test.set<span class="p">)</span>
<span class="o">&gt;</span> head<span class="p">(</span>p<span class="p">@</span>df<span class="p">)</span>
   id  truth response
<span class="m">2</span>   <span class="m">2</span> setosa   setosa
<span class="m">4</span>   <span class="m">4</span> setosa   setosa
<span class="m">6</span>   <span class="m">6</span> setosa   setosa
<span class="m">8</span>   <span class="m">8</span> setosa   setosa
<span class="m">10</span> <span class="m">10</span> setosa   setosa
<span class="m">12</span> <span class="m">12</span> setosa   setosa
</pre></div>
</div>
<p>The row names of the prediction data.frame tells us for which element
of the original data set the prediction is:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> rownames<span class="p">(</span>p<span class="p">@</span>df<span class="p">)</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;2&quot;</span>   <span class="s">&quot;4&quot;</span>   <span class="s">&quot;6&quot;</span>   <span class="s">&quot;8&quot;</span>   <span class="s">&quot;10&quot;</span>  <span class="s">&quot;12&quot;</span>  <span class="s">&quot;14&quot;</span>  <span class="s">&quot;16&quot;</span>  <span class="s">&quot;18&quot;</span>  <span class="s">&quot;20&quot;</span>  <span class="s">&quot;22&quot;</span>  <span class="s">&quot;24&quot;</span>
<span class="p">[</span><span class="m">13</span><span class="p">]</span> <span class="s">&quot;26&quot;</span>  <span class="s">&quot;28&quot;</span>  <span class="s">&quot;30&quot;</span>  <span class="s">&quot;32&quot;</span>  <span class="s">&quot;34&quot;</span>  <span class="s">&quot;36&quot;</span>  <span class="s">&quot;38&quot;</span>  <span class="s">&quot;40&quot;</span>  <span class="s">&quot;42&quot;</span>  <span class="s">&quot;44&quot;</span>  <span class="s">&quot;46&quot;</span>  <span class="s">&quot;48&quot;</span>
<span class="p">[</span><span class="m">25</span><span class="p">]</span> <span class="s">&quot;50&quot;</span>  <span class="s">&quot;52&quot;</span>  <span class="s">&quot;54&quot;</span>  <span class="s">&quot;56&quot;</span>  <span class="s">&quot;58&quot;</span>  <span class="s">&quot;60&quot;</span>  <span class="s">&quot;62&quot;</span>  <span class="s">&quot;64&quot;</span>  <span class="s">&quot;66&quot;</span>  <span class="s">&quot;68&quot;</span>  <span class="s">&quot;70&quot;</span>  <span class="s">&quot;72&quot;</span>
<span class="p">[</span><span class="m">37</span><span class="p">]</span> <span class="s">&quot;74&quot;</span>  <span class="s">&quot;76&quot;</span>  <span class="s">&quot;78&quot;</span>  <span class="s">&quot;80&quot;</span>  <span class="s">&quot;82&quot;</span>  <span class="s">&quot;84&quot;</span>  <span class="s">&quot;86&quot;</span>  <span class="s">&quot;88&quot;</span>  <span class="s">&quot;90&quot;</span>  <span class="s">&quot;92&quot;</span>  <span class="s">&quot;94&quot;</span>  <span class="s">&quot;96&quot;</span>
<span class="p">[</span><span class="m">49</span><span class="p">]</span> <span class="s">&quot;98&quot;</span>  <span class="s">&quot;100&quot;</span> <span class="s">&quot;102&quot;</span> <span class="s">&quot;104&quot;</span> <span class="s">&quot;106&quot;</span> <span class="s">&quot;108&quot;</span> <span class="s">&quot;110&quot;</span> <span class="s">&quot;112&quot;</span> <span class="s">&quot;114&quot;</span> <span class="s">&quot;116&quot;</span> <span class="s">&quot;118&quot;</span> <span class="s">&quot;120&quot;</span>
<span class="p">[</span><span class="m">61</span><span class="p">]</span> <span class="s">&quot;122&quot;</span> <span class="s">&quot;124&quot;</span> <span class="s">&quot;126&quot;</span> <span class="s">&quot;128&quot;</span> <span class="s">&quot;130&quot;</span> <span class="s">&quot;132&quot;</span> <span class="s">&quot;134&quot;</span> <span class="s">&quot;136&quot;</span> <span class="s">&quot;138&quot;</span> <span class="s">&quot;140&quot;</span> <span class="s">&quot;142&quot;</span> <span class="s">&quot;144&quot;</span>
<span class="p">[</span><span class="m">73</span><span class="p">]</span> <span class="s">&quot;146&quot;</span> <span class="s">&quot;148&quot;</span> <span class="s">&quot;150&quot;</span>
</pre></div>
</div>
<p>We can also predict probabilities instead of a class label:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> wl <span class="o">&lt;-</span> makeLearner<span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span> predict.type <span class="o">=</span> <span class="s">&quot;prob&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> wm <span class="o">&lt;-</span> train<span class="p">(</span>wl<span class="p">,</span> ct<span class="p">)</span>
<span class="o">&gt;</span> p <span class="o">&lt;-</span> predict<span class="p">(</span>wm<span class="p">,</span> newdata <span class="o">=</span> iris<span class="p">[</span>test.set<span class="p">,</span> <span class="p">])</span>
<span class="o">&gt;</span> head<span class="p">(</span>p<span class="p">@</span>df<span class="p">)</span>
    truth prob.setosa prob.versicolor prob.virginica response
<span class="m">2</span>  setosa           <span class="m">1</span>               <span class="m">0</span>              <span class="m">0</span>   setosa
<span class="m">4</span>  setosa           <span class="m">1</span>               <span class="m">0</span>              <span class="m">0</span>   setosa
<span class="m">6</span>  setosa           <span class="m">1</span>               <span class="m">0</span>              <span class="m">0</span>   setosa
<span class="m">8</span>  setosa           <span class="m">1</span>               <span class="m">0</span>              <span class="m">0</span>   setosa
<span class="m">10</span> setosa           <span class="m">1</span>               <span class="m">0</span>              <span class="m">0</span>   setosa
<span class="m">12</span> setosa           <span class="m">1</span>               <span class="m">0</span>              <span class="m">0</span>   setosa
</pre></div>
</div>
<p>As you can see, in addition to the predicted probabilities, a response
is produced by choosing the class with the maximum probability and
breaking ties at random.</p>
<div class="section" id="binary-classification">
<h3>Binary Classification<a class="headerlink" href="#binary-classification" title="Permalink to this headline">¶</a></h3>
<p>For binary classification threshold.
makeClassifTask positive class</p>
<p>To illustrate binary classification we use the Sonar dataset from the
<a class="reference external" href="http://cran.r-project.org/web/packages/mlbench/index.html">mlbench</a> library.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>mlbench<span class="p">)</span>
<span class="o">&gt;</span> data<span class="p">(</span>Sonar<span class="p">)</span>
</pre></div>
</div>
<p>Again we create a classification task and a learner which predicts
probabilities, train the learner and then predict the class labels on
the data used to train the learner:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> ct <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span>data <span class="o">=</span> Sonar<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;Class&quot;</span><span class="p">,</span> positive <span class="o">=</span> <span class="s">&quot;M&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> wl <span class="o">&lt;-</span> makeLearner<span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span> predict.type <span class="o">=</span> <span class="s">&quot;prob&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> wm <span class="o">&lt;-</span> train<span class="p">(</span>wl<span class="p">,</span> task <span class="o">=</span> ct<span class="p">)</span>
<span class="o">&gt;</span> p <span class="o">&lt;-</span> predict<span class="p">(</span>wm<span class="p">,</span> task <span class="o">=</span> ct<span class="p">)</span>
<span class="o">&gt;</span> head<span class="p">(</span>p<span class="p">@</span>df<span class="p">)</span>
  id truth    prob.M    prob.R response
<span class="m">1</span>  <span class="m">1</span>     R <span class="m">0.1060606</span> <span class="m">0.8939394</span>        R
<span class="m">2</span>  <span class="m">2</span>     R <span class="m">0.7333333</span> <span class="m">0.2666667</span>        M
<span class="m">3</span>  <span class="m">3</span>     R <span class="m">0.0000000</span> <span class="m">1.0000000</span>        R
<span class="m">4</span>  <span class="m">4</span>     R <span class="m">0.1060606</span> <span class="m">0.8939394</span>        R
<span class="m">5</span>  <span class="m">5</span>     R <span class="m">0.9250000</span> <span class="m">0.0750000</span>        M
<span class="m">6</span>  <span class="m">6</span>     R <span class="m">0.0000000</span> <span class="m">1.0000000</span>        R
</pre></div>
</div>
<p>In a binary classification setting, we can adjust the threshold used
to map probabilities to class labels using <a class="reference external" href="/_static/mlr/setThreshold.html">setThreshold</a>. Here we set
the threshold for the <em>positive</em> class to 0.8:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> pt <span class="o">&lt;-</span> setThreshold<span class="p">(</span>p<span class="p">,</span> <span class="m">0.8</span><span class="p">)</span>
<span class="o">&gt;</span> head<span class="p">(</span>pt<span class="p">@</span>df<span class="p">)</span>
  id truth    prob.M    prob.R response
<span class="m">1</span>  <span class="m">1</span>     R <span class="m">0.1060606</span> <span class="m">0.8939394</span>        R
<span class="m">2</span>  <span class="m">2</span>     R <span class="m">0.7333333</span> <span class="m">0.2666667</span>        R
<span class="m">3</span>  <span class="m">3</span>     R <span class="m">0.0000000</span> <span class="m">1.0000000</span>        R
<span class="m">4</span>  <span class="m">4</span>     R <span class="m">0.1060606</span> <span class="m">0.8939394</span>        R
<span class="m">5</span>  <span class="m">5</span>     R <span class="m">0.9250000</span> <span class="m">0.0750000</span>        M
<span class="m">6</span>  <span class="m">6</span>     R <span class="m">0.0000000</span> <span class="m">1.0000000</span>        R
</pre></div>
</div>
</div>
</div>
<div class="section" id="regression-example">
<h2>Regression example<a class="headerlink" href="#regression-example" title="Permalink to this headline">¶</a></h2>
<p>We again use the BostonHousing data set and learn a Gradient Boosting
Machine. We use every second observation for training/test. &lt;br&gt; The
proceeding is analog to above.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>mlbench<span class="p">)</span>
<span class="o">&gt;</span> data<span class="p">(</span>BostonHousing<span class="p">)</span>
<span class="o">&gt;</span> rt <span class="o">&lt;-</span> makeRegrTask<span class="p">(</span>data <span class="o">=</span> BostonHousing<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;medv&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> train.set <span class="o">&lt;-</span> seq<span class="p">(</span>from <span class="o">=</span> <span class="m">1</span><span class="p">,</span> to <span class="o">=</span> nrow<span class="p">(</span>BostonHousing<span class="p">),</span> by <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
<span class="o">&gt;</span> test.set <span class="o">&lt;-</span> seq<span class="p">(</span>from <span class="o">=</span> <span class="m">2</span><span class="p">,</span> to <span class="o">=</span> nrow<span class="p">(</span>BostonHousing<span class="p">),</span> by <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
<span class="o">&gt;</span> wl <span class="o">&lt;-</span> makeLearner<span class="p">(</span><span class="s">&quot;regr.gbm&quot;</span><span class="p">,</span> n.trees <span class="o">=</span> <span class="m">100</span><span class="p">)</span>
Loaded gbm <span class="m">1.6</span><span class="o">-</span><span class="m">3.1</span>
<span class="o">&gt;</span> wm <span class="o">&lt;-</span> train<span class="p">(</span>wl<span class="p">,</span> rt<span class="p">,</span> subset <span class="o">=</span> train.set<span class="p">)</span>
<span class="o">&gt;</span> p <span class="o">&lt;-</span> predict<span class="p">(</span>wm<span class="p">,</span> newdata <span class="o">=</span> BostonHousing<span class="p">[</span>test.set<span class="p">,</span> <span class="p">])</span>
</pre></div>
</div>
<p>We access the prediction result just like in the classification case:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> head<span class="p">(</span>p<span class="p">@</span>df<span class="p">)</span>
  truth response
<span class="m">1</span>  <span class="m">21.6</span> <span class="m">22.30574</span>
<span class="m">2</span>  <span class="m">33.4</span> <span class="m">23.34756</span>
<span class="m">3</span>  <span class="m">28.7</span> <span class="m">22.41089</span>
<span class="m">4</span>  <span class="m">27.1</span> <span class="m">22.12809</span>
<span class="m">5</span>  <span class="m">18.9</span> <span class="m">22.12809</span>
<span class="m">6</span>  <span class="m">18.9</span> <span class="m">22.13829</span>
</pre></div>
</div>
<p>To calculate the mean squared error, we might do:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> squared_error <span class="o">&lt;-</span> <span class="p">(</span>p<span class="p">@</span>df<span class="p">$</span>truth <span class="o">-</span> p<span class="p">@</span>df<span class="p">$</span>response<span class="p">)</span><span class="o">^</span><span class="m">2</span>
<span class="o">&gt;</span> mean<span class="p">(</span>squared_error<span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">76.34354</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
<h3>Table Of Contents</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="train.html">Training a learner</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Predicting Outcomes for New Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#classification-example">Classification example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#binary-classification">Binary Classification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#regression-example">Regression example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="resample.html">Resampling Learners</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Evaluateing Learner Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="tune.html">Tuning hyperparamaters</a></li>
<li class="toctree-l2"><a class="reference internal" href="learner.html">Integrated learners</a></li>
<li class="toctree-l2"><a class="reference internal" href="variable_selection.html">Variable Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmark_experiments.html">Benchmark Experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmark_analysis.html">Benchmark Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="roc_analysis.html">ROC Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concept/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrated_learners.html">Integrated Learners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../literature.html">Relevant Literature</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="train.html" title="Training a learner"
             >previous</a> |
          <a href="resample.html" title="Resampling Learners"
             >next</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2010-2011, Bernd Bischl et.al..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>