

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>9. Benchmark Experiments &mdash; mlr - Machine Learning in R</title>
    
    <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="mlr - Machine Learning in R" href="../index.html" />
    <link rel="up" title="Tutorial" href="index.html" />
    <link rel="next" title="10. Benchmark Analysis" href="benchmark_analysis.html" />
    <link rel="prev" title="8. Variable Selection" href="variable_selection.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <p class="logo"><a href="../index.html">
            <img class="logo" src="../_static/mlr_logo-120x64.png" alt="mlr logo"/>
        </a></p>
        <h1><a href="../index.html">mlr - Machine Learning in R</a></h1>
        <div class="rel">
          <a href="variable_selection.html" title="8. Variable Selection"
             accesskey="P">previous</a> |
          <a href="benchmark_analysis.html" title="10. Benchmark Analysis"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="benchmark-experiments">
<h1>9. Benchmark Experiments<a class="headerlink" href="#benchmark-experiments" title="Permalink to this headline">¶</a></h1>
<p>In order to get an unbiased estimate of the performance on new data,
it is generally not enough to simply use repeated cross-validations
for a given set of hyperparameters and methods (see Section <a class="reference internal" href="tune.html"><em>Tuning Hyperparameters</em></a>),
as this might produce an overly optimistic result.</p>
<p>A better (although more time-consuming) approach is nesting two
resampling methods.  To make the explanation easier, let&#8217;s take
cross-validations, in this case also called &#8220;double cross-validation&#8221;.
In the so called &#8220;outer&#8221; cross-validation the data is split repeatedly
into a (larger) training set and a (smaller) test set in the usual
way. Now, in every outer iteration the learner is tuned on the
training set by performing an &#8220;inner&#8221; cross-validation. The best found
hyperparameters are selected, with these the learner is fitted to the
complete &#8220;outer&#8221; training set and the resulting model is used to
access the (outer) test set.  This results in much more reliable
estimates of true performance distribution of the learner for unseen
data.  These can now be used to estimate locations (e.g. of the mean
or median performance value) and to compare learning methods in a fair
way.</p>
<p>In the following we will see four examples to show different benchmark settings:</p>
<ul class="simple">
<li>One data set  +       two classification algorithms</li>
<li>One data set  +       one classification algorithm    +       tuning</li>
<li>Three data sets       +       three classification algorithms +       tuning</li>
<li>One data set  +       two classification algorithms   +       variable selection</li>
</ul>
<div class="section" id="example-1-one-task-two-learners-no-tuning">
<h2>9.1. Example 1: One task, two learners, no tuning<a class="headerlink" href="#example-1-one-task-two-learners-no-tuning" title="Permalink to this headline">¶</a></h2>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span><span class="s">&quot;mlr&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Classification task with iris data set</span>
<span class="o">&gt;</span> task <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span>data <span class="o">=</span> iris<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;Species&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Two learners to be compared</span>
<span class="o">&gt;</span> learners <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;classif.lda&quot;</span><span class="p">,</span> <span class="s">&quot;classif.qda&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Define cross-validation indices</span>
<span class="o">&gt;</span> rdesc <span class="o">&lt;-</span> makeResampleDescription<span class="p">(</span><span class="s">&quot;CV&quot;</span><span class="p">,</span> iters <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
<span class="o">&gt;</span> res <span class="o">&lt;-</span> bench.exp<span class="p">(</span>learners<span class="p">,</span> task<span class="p">,</span> rdesc<span class="p">)</span>
</pre></div>
</div>
<p>The above code should be mainly self-explanatory. In the result every
column corresponds to one learner.  The entries show the mean test
error and its standard deviation for the final fitted model.</p>
<p>But the Benchmark result contains much more information, which you can
access if you want to see details. Let&#8217;s have a look to the benchmark
result from the example above:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> <span class="c1">## Access further information</span>
<span class="o">&gt;</span> <span class="c1">## The single performances of the cross-validation runs</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;perf&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="c1">## Confusion matrices - one for each learner</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;conf.mats&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2-one-task-one-learner-tuning">
<h2>9.2. Example 2: One task, one learner, tuning<a class="headerlink" href="#example-2-one-task-one-learner-tuning" title="Permalink to this headline">¶</a></h2>
<p>Now we have a learner with hyperparameters and we want to find out,
which are the best ones. In that case we have two resampling levels.</p>
<p>We show an example with outer bootstrap and inner cross-validation,
our learner will be k-nearest-neighbor.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> <span class="c1">## Classification task with iris data set</span>
<span class="o">&gt;</span> task <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span>data <span class="o">=</span> iris<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;Species&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Range of hyperparameter k</span>
<span class="o">&gt;</span> ps <span class="o">&lt;-</span> makeParameterSet<span class="p">(</span>makeDiscreteParameter<span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span> <span class="m">1</span>:<span class="m">5</span><span class="p">))</span>
<span class="o">&gt;</span> ctrl <span class="o">&lt;-</span> makeTuneControlGrid<span class="p">(</span>ranges <span class="o">=</span> ps<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Define &quot;inner&quot; cross-validation indices</span>
<span class="o">&gt;</span> inner.rdesc <span class="o">&lt;-</span> makeResampleDesc<span class="p">(</span><span class="s">&quot;CV&quot;</span><span class="p">,</span> iters <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Tune k-nearest-neighbor</span>
<span class="o">&gt;</span> lrn <span class="o">&lt;-</span> makeTuneWrapper<span class="p">(</span><span class="s">&quot;classif.kknn&quot;</span><span class="p">,</span>
<span class="o">+</span>                                resampling <span class="o">=</span> inner.rdesc<span class="p">,</span>
<span class="o">+</span>                                control <span class="o">=</span> ctrl<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Define &quot;outer&quot; bootstrap indices</span>
<span class="o">&gt;</span> rdesc <span class="o">&lt;-</span> makeResampleDesc<span class="p">(</span><span class="s">&quot;BS&quot;</span><span class="p">,</span> iters <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Merge it to a benchmark experiment</span>
<span class="o">&gt;</span> <span class="c1">## Choose accuracy instead of default measure mean misclassification error</span>
<span class="o">&gt;</span> res <span class="o">&lt;-</span> bench.exp<span class="p">(</span>lrn<span class="p">,</span> task<span class="p">,</span> rdesc<span class="p">,</span> measure <span class="o">=</span> acc<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Which performances did we get in the single runs?</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;perf&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="c1">## Which parameter belong to the performances?</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;tuned.par&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="c1">## What does the confusion matrix look like?</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;conf.mats&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Of course everything works the same way if we exchange the resampling
strategy either in the outer or inner run.  They can be freely
mixed.</p>
</div>
<div class="section" id="example-3-three-tasks-three-learners-tuning">
<h2>9.3. Example 3: Three tasks, three learners, tuning<a class="headerlink" href="#example-3-three-tasks-three-learners-tuning" title="Permalink to this headline">¶</a></h2>
<p>Extensive example which shows a benchmark experiment with three data
sets, three learners and tuning.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span><span class="s">&quot;dprep&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> library<span class="p">(</span><span class="s">&quot;mlbench&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> data<span class="p">(</span>BreastCancer<span class="p">)</span>
<span class="o">&gt;</span> data<span class="p">(</span>Vehicle<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Classification task with three data sets</span>
<span class="o">&gt;</span> task1 <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span><span class="s">&quot;Iris&quot;</span><span class="p">,</span> data <span class="o">=</span> iris<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;Species&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> task2 <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span><span class="s">&quot;Vehicle&quot;</span><span class="p">,</span> data <span class="o">=</span> Vehicle<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;Class&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> task3 <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span><span class="s">&quot;BreastCancer&quot;</span><span class="p">,</span> data <span class="o">=</span> na.omit<span class="p">(</span>BreastCancer<span class="p">),</span> target <span class="o">=</span> <span class="s">&quot;Class&quot;</span><span class="p">,</span> excluded <span class="o">=</span> <span class="s">&quot;Id&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Merge to one task</span>
<span class="o">&gt;</span> tasks <span class="o">=</span> list<span class="p">(</span>task1 <span class="p">,</span> task2 <span class="p">,</span> task3<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Very small grid for SVM hyperparameters</span>
<span class="o">&gt;</span> ps <span class="o">&lt;-</span> makeParameterSet<span class="p">(</span>makeDiscreteParameter<span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">,</span> <span class="m">2</span><span class="o">^</span>seq<span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">)),</span> makeDiscreteParameter<span class="p">(</span><span class="s">&quot;sigma&quot;</span><span class="p">,</span> <span class="m">2</span><span class="o">^</span>seq<span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">)))</span>
<span class="o">&gt;</span> ctrl <span class="o">&lt;-</span> makeTuneControlGrid<span class="p">(</span>ranges <span class="o">=</span> ps<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Define &quot;inner&quot; cross-validation indices</span>
<span class="o">&gt;</span> inner.rdesc <span class="o">&lt;-</span> makeResampleDesc<span class="p">(</span><span class="s">&quot;CV&quot;</span><span class="p">,</span> iters <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Tune a SVM</span>
<span class="o">&gt;</span> lrn <span class="o">&lt;-</span> makeTuneWrapper<span class="p">(</span><span class="s">&quot;classif.ksvm&quot;</span><span class="p">,</span> method <span class="o">=</span> <span class="s">&quot;grid&quot;</span><span class="p">,</span> resampling <span class="o">=</span> inner.rdesc<span class="p">,</span>
<span class="o">+</span>                                control <span class="o">=</span> ctrl<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Three learners to be compared</span>
<span class="o">&gt;</span> learners <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;classif.lda&quot;</span><span class="p">,</span> <span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span> lrn<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Define &quot;outer&quot; cross-validation indices</span>
<span class="o">&gt;</span> rdesc <span class="o">&lt;-</span> makeResampleDesc<span class="p">(</span><span class="s">&quot;CV&quot;</span><span class="p">,</span> iters <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Merge it to a benchmark experiment</span>
<span class="o">&gt;</span> res <span class="o">&lt;-</span> bench.exp<span class="p">(</span>learners<span class="p">,</span> tasks<span class="p">,</span> rdesc<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Only for one task</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;perf&quot;</span><span class="p">,</span> task <span class="o">=</span> <span class="s">&quot;Iris&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="c1">## Only for one learner</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;perf&quot;</span><span class="p">,</span> learner <span class="o">=</span> <span class="s">&quot;classif.lda&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="c1">## Tuned parameter for SVM</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;tuned.par&quot;</span><span class="p">,</span> learner <span class="o">=</span> <span class="s">&quot;classif.ksvm&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="c1">## Confusion matrix for one learner and one task</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;conf.mats&quot;</span><span class="p">,</span> learner <span class="o">=</span> <span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span> task <span class="o">=</span> <span class="s">&quot;BreastCancer&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="c1">## Optimal performance of the inner (!) resampling, i.e. here 3-fold cross-validation</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;opt.perf&quot;</span><span class="p">,</span> learner <span class="o">=</span> <span class="s">&quot;classif.ksvm&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="example-4-one-task-two-learners-variable-selection">
<h2>9.4. Example 4: One task, two learners, variable selection<a class="headerlink" href="#example-4-one-task-two-learners-variable-selection" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s see how we can do <a class="reference internal" href="variable_selection.html"><em>variable selection</em></a> in
a benchmark experiment:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> <span class="c1">## Classification task with iris data set</span>
<span class="o">&gt;</span> task <span class="o">&lt;-</span> makeClassifTask<span class="p">(</span><span class="s">&quot;iris&quot;</span><span class="p">,</span> data<span class="o">=</span>iris<span class="p">,</span> target <span class="o">=</span> <span class="s">&quot;Species&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Control object for variable selection</span>
<span class="o">&gt;</span> ctrl <span class="o">&lt;-</span> makeVarselControlSequential<span class="p">(</span>beta <span class="o">=</span> <span class="m">100</span><span class="p">,</span> method<span class="o">=</span><span class="s">&quot;sfs&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Inner resampling</span>
<span class="o">&gt;</span> inner.rdesc <span class="o">&lt;-</span> makeResampleDesc<span class="p">(</span><span class="s">&quot;CV&quot;</span><span class="p">,</span> iter<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Variable selection with Sequential Forward Search</span>
<span class="o">&gt;</span> lrn <span class="o">&lt;-</span> makeVarselWrapper<span class="p">(</span><span class="s">&quot;classif.lda&quot;</span><span class="p">,</span> resampling <span class="o">=</span> inner.rdesc<span class="p">,</span> control <span class="o">=</span> ctrl<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Let&#39;s compare two learners</span>
<span class="o">&gt;</span> learners <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span> lrn<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Define outer resampling</span>
<span class="o">&gt;</span> rdesc <span class="o">&lt;-</span> makeResampleDesc<span class="p">(</span><span class="s">&quot;subsample&quot;</span><span class="p">,</span> iter <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Merge to a benchmark experiment</span>
<span class="o">&gt;</span> res <span class="o">&lt;-</span> bench.exp<span class="p">(</span>tasks <span class="o">=</span> task<span class="p">,</span> learners <span class="o">=</span> learners<span class="p">,</span> resampling <span class="o">=</span> rdesc<span class="p">)</span>
<span class="o">&gt;</span> <span class="c1">## Which variables have been selected (in the outer resampling steps)?</span>
<span class="o">&gt;</span> res<span class="p">[</span><span class="s">&quot;sel.var&quot;</span><span class="p">,</span> learner<span class="o">=</span><span class="s">&quot;classif.lda&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
<h3>Table Of Contents</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="task.html">1. Learning Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="learner.html">2. Learners</a></li>
<li class="toctree-l2"><a class="reference internal" href="train.html">3. Training a Learner</a></li>
<li class="toctree-l2"><a class="reference internal" href="predict.html">4. Predicting Outcomes for New Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">5. Evaluating Learner Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="resample.html">6. Resampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="tune.html">7. Tuning Hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="variable_selection.html">8. Variable Selection</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">9. Benchmark Experiments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-1-one-task-two-learners-no-tuning">9.1. Example 1: One task, two learners, no tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-2-one-task-one-learner-tuning">9.2. Example 2: One task, one learner, tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-3-three-tasks-three-learners-tuning">9.3. Example 3: Three tasks, three learners, tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-4-one-task-two-learners-variable-selection">9.4. Example 4: One task, two learners, variable selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="benchmark_analysis.html">10. Benchmark Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="roc_analysis.html">11. ROC Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../integrated_learners.html">Integrated Learners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extension_points/index.html">Extension Points</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../literature.html">Relevant Literature</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="variable_selection.html" title="8. Variable Selection"
             >previous</a> |
          <a href="benchmark_analysis.html" title="10. Benchmark Analysis"
             >next</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2010-2011, Bernd Bischl et.al..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>