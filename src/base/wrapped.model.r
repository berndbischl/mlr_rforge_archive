#' @include wrapped.learner.r
roxygen()


#' A classifier model is generated by \code{\link{train}}. It consists of the learn.task,
#' the classification model, the used hyperparameters and a vector specifying the cases of the training sample. 
#' 
#' @slot task.class Class of learn.task from which the model was generated. 
#' @slot wrapped.learner Wrapped learner from which the model was generated.
#' @slot learner.model Underlying learner model from existing R packages.
#' @slot target Name of the target variable. 
#' @slot subset An index vector specifying the cases of the training sample that were used for the model. 
#' @slot vars Vector specifying the variables which were used to build the model. 
#' @slot parset Contains the hyperparameters of the train function. If empty no parameters were used.
#' 
#' @title Induced model of learner
 
setClass(
		"wrapped.model",
		representation = representation(
				task.class = "character",
				wrapped.learner = "wrapped.learner",
				learner.model = "ANY",
				target = "character",
				subset = "numeric",
				vars = "character",
				parset = "list"
		)
)

#' Wrapped model for classification task.  
#' 
#' @slot class.levels Levels of the target factor. 
#' @slot type Indicates, whether the default is to predict classes or probabilities ("class" or "prob").  
#' 
#' @examples  see \link{train}
#' 
#' @title wrapped.model.classif

setClass(
		"wrapped.model.classif",
		contains = c("wrapped.model"),
		representation = representation(
				class.levels = "character",
				type = "character"
		)
)

#' Wrapped model for regression task.  
#' 
#' @examples  see \link{train}
#' 
#' @title wrapped.model.classif

setClass(
		"wrapped.model.regr",
		contains = c("wrapped.model")
)





#' Conversion to string.
setMethod(
		f = "as.character",
		signature = signature("wrapped.model"),
		def = function(x) {
			ps <- paste(names(x@parset), x@parset, sep="=", collapse=" ")
			f = x["fail"]
			f = ifelse(is.null(f), "", paste("Training failed:", f))
			return(
					paste(
							"Learner model for ", x@wrapped.learner@learner.name, "\n",  
							"Hyperparameters: ", ps, "\n",
							"Trained on obs: ", length(x@subset), "\n",
							f,
							sep=""
					)
			)
		}
)

#' Prints the object by calling as.character.
setMethod(
		f = "print",
		signature = signature("wrapped.model"),
		def = function(x, ...) {
			cat(as.character(x))
		}
)

#' Shows the object by calling as.character.
setMethod(
		f = "show",
		signature = signature("wrapped.model"),
		def = function(object) {
			cat(as.character(object))
		}
)


#' Getter.
#' @param x wrapped.model object
#' @param i [\code{\link{character}}]
#' \describe{
#'	 \item{<slot>}{A slot of the class.}
#' 	 \item{fail}{Generally NULL but if the training failed, the error message of the underlying train function.}
#' }
#' 
#' @rdname getter,wrapped.model-method
#' @aliases wrapped.model.getter getter,wrapped.model-method
#' @title Getter for wrapped.model

setMethod(
		f = "[",
		signature = signature("wrapped.model"),
		def = function(x,i,j,...,drop) {
			if (i == "fail"){
				if (is(x@learner.model, "learner.failure"))
					return(x@learner.model@msg)
				else
					return(NULL)
			}
			return(
					eval(substitute("@"(x, slot), list(slot=i)))
			)
		}
)













